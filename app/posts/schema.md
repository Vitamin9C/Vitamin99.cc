## Create Tables

```sql
-- 1. Create the Tweets Table
create table tweets (
  id uuid default gen_random_uuid() primary key,
  user_id uuid references auth.users not null, -- Links to Supabase Auth
  
  -- Content
  content text, -- The actual text of the tweet
  media_attachments jsonb default '[]'::jsonb, -- Store image URLs/metadata here
  
  -- Threading (Self-referencing)
  parent_tweet_id uuid references tweets(id), -- If this is a reply to another tweet
  
  -- Status & Scheduling
  is_published boolean default false,
  published_at timestamp with time zone, -- actual post / scheduled post
  created_at timestamp with time zone default now(), -- draft
  updated_at timestamp with time zone default now(),
  
  -- Analytics & Metadata
  view_count bigint default 0,
  like_count bigint default 0,
  metadata jsonb default '{}'::jsonb -- Flexible field for extra data (location, mood, etc.)
);

-- Tags Table 
-- (for mapping multiple tweets - multiple tags)
create table tags (
  id bigint generated by default as identity primary key,
  name text unique not null,
  slug text unique not null
);

-- 3. Create Junction Table (Many-to-Many relationship for tweets and tags)
create table tweet_tags (
  tweet_id uuid references tweets(id) on delete cascade,
  tag_id bigint references tags(id) on delete cascade,
  primary key (tweet_id, tag_id)
);
```

## Manage Security

```sql
-- Enable RLS (Row Level Security)
alter table tweets enable row level security;

-- ALlow Select for public
create policy "Public can view tweets"
on tweets for select
to public
using ( true );

-- Allow Select for designated email addresse
create policy "Only admin can insert tweets"
on tweets for insert
to authenticated
with check ( auth.jwt() ->> 'email' = 'your-email@example.com');

-- Add missing policies for tweets table
CREATE POLICY "Only admin can update tweets"
ON tweets FOR UPDATE
TO authenticated
USING (auth.jwt() ->> 'email' = 'YOUR_EMAIL@example.com');

CREATE POLICY "Only admin can delete tweets"
ON tweets FOR DELETE
TO authenticated
USING (auth.jwt() ->> 'email' = 'YOUR_EMAIL@example.com');

-- Enable RLS and add policies for tweet_tags
ALTER TABLE tweet_tags ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Public can view tweet_tags"
ON tweet_tags FOR SELECT
TO public
USING (true);

CREATE POLICY "Admin can insert tweet_tags"
ON tweet_tags FOR INSERT
TO authenticated
WITH CHECK (auth.jwt() ->> 'email' = 'YOUR_EMAIL@example.com');

CREATE POLICY "Admin can delete tweet_tags"
ON tweet_tags FOR DELETE
TO authenticated
USING (auth.jwt() ->> 'email' = 'YOUR_EMAIL@example.com');

-- Enable RLS and add policies for tags
ALTER TABLE tags ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Public can view tags"
ON tags FOR SELECT
TO public
USING (true);

CREATE POLICY "Admin can insert tags"
ON tags FOR INSERT
TO authenticated
WITH CHECK (auth.jwt() ->> 'email' = 'YOUR_EMAIL@example.com');

CREATE POLICY "Admin can update tags"
ON tags FOR UPDATE
TO authenticated
USING (auth.jwt() ->> 'email' = 'YOUR_EMAIL@example.com');

CREATE POLICY "Admin can delete tags"
ON tags FOR DELETE
TO authenticated
USING (auth.jwt() ->> 'email' = 'YOUR_EMAIL@example.com');

```

## Index to improve performance

```sql
-- Make filtering by publish date fast
create index tweets_published_at_idx on tweets(published_at) where is_published = true;

-- Make finding threads fast
create index tweets_parent_id_idx on tweets(parent_tweet_id);
```

```json
# jsonb metadata
[
  { "type": "image", "url": "https://.../img1.jpg", "alt": "My setup" },
  { "type": "video", "url": "https://.../vid.mp4" }
]
```